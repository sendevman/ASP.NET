<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

	<head>
		<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
		<title>Dapper Usage</title>
		<link type="text/css" rel="stylesheet" href="bootstrap.min.css" />
	</head>

	<body>

		<div class="document-contents">


		<h3 id="DocIntroduction">Introduction</h3>
			<p><a href="https://github.com/StackExchange/Dapper" target="_blank">Dapper</a> is an object-relational mapping (ORM) product for .NET. 
			<a href="https://www.nuget.org/packages/Abp.Dapper" target="_blank">Abp.Dapper</a> package simply integrates Dapper to ASP.NET Boilerplate.</p>

			<h3 id="DocQuickStart">Quick Start</h3>
			<p>Before you start, you need to install <a href="https://www.nuget.org/packages/Abp.Dapper" target="_blank">Abp.Dapper</a> and one of EF Core, EF 6.x and NHibernate ORM nuget packages 
			to project that you want to use it. For example you can install <a href="https://www.nuget.org/packages/Abp.EntityFrameworkCore" target="_blank">Abp.EntityFrameworkCore</a> like following example.
			</p>
			
			<h4>Module Registration</h3>
			
			<p>First you need to add <strong>DependsOn</strong> attribute for <strong>AbpDapperModule</strong> on your module where you register it.</p>
			
			<p><strong>NOTE:</strong> Modules need to be added by order.</p>
			
			<pre lang="cs">[DependsOn(
     typeof(AbpEntityFrameworkCoreModule),
     typeof(AbpDapperModule)
)]
public class SampleApplicationModule : AbpModule
{
    public override void Initialize()
    {
        IocManager.RegisterAssemblyByConvention(typeof(SampleApplicationModule).GetAssembly());
    }
}
			</pre>
			
			<h4>Entity to Table Mapping</h4>

			<p>You should define mappings, if your entities and tables don't have the same name. For example, <strong>Person</strong> class reference <strong>AbpPerson</strong> table. So you should define a mapping between them.</p>
			
			<pre lang="cs">public class PersonMapper : ClassMapper&lt;Person&gt;
{
    public PersonMapper()
    {
        //use different table name
        Table("AbpPerson");

        Map(x => x.Roles).Ignore();

        AutoMap();
    }
}</pre>
			
			<p>After define mappings, you need to register them in module initialize method.</p>
						<pre lang="cs">[DependsOn(
     typeof(AbpEntityFrameworkModule),
     typeof(AbpDapperModule)
)]
public class SampleApplicationModule : AbpModule
{
    public override void Initialize()
    {
        IocManager.RegisterAssemblyByConvention(typeof(SampleApplicationModule).GetAssembly());
        <strong>DapperExtensions.DapperExtensions.SetMappingAssemblies(new List<Assembly> { typeof(SampleApplicationModule).GetAssembly() });</strong>
    }
}
			</pre>
			
			<h3 id="DocUsage">Usage</h3>

			
			<p>After registering <strong>AbpDapperModule</strong>, you can use Generic IDapperRepository interface (instead of standard IRepository) to inject dapper repositories.</p>
			<pre lang="cs">public class SomeApplicationService : ITransientDependency
{
    private readonly IDapperRepository&lt;Person&gt; _personDapperRepository;
    private readonly IRepository&lt;Person&gt; _personRepository;

    public SomeApplicationService(
        IRepository&lt;Person&gt; personRepository,
        IDapperRepository&lt;Person&gt; personDapperRepository)
    {
        _personRepository = personRepository;
        _personDapperRepository = personDapperRepository;
    }

    public void DoSomeStuff()
    {
        _personRepository.Insert(new Person("John"));
        _personRepository.Insert(new Person("Bread"));

        Person person = _personDapperRepository.Get(1);
        int personCount = _personDapperRepository.Count(x => x.Name == "John");
        List&lt;Person&gt; persons = _personDapperRepository.GetList(x => x.Name.StartsWith("J")).ToList();
        List&lt;Person&gt; sqlQueryPersons = _personDapperRepository.Query("select * from Persons where Name = 'john'");
    }
}
</pre>
			<p>You can use both EF repositories and Dapper repositories at the same time.</p>
			

		</div>
	</body>

</html>
